version: '3.8'

services:
    app:
        build:
            context: .
            dockerfile: Dockerfile
        image: laravel-app
        container_name: laravel-app
        restart: unless-stopped
        working_dir: /var/www/html
        ports:
            - "80:80"
        volumes:
            - ./storage:/var/www/html/storage
            - ./database/database.sqlite:/var/www/html/database/database.sqlite  # For SQLite
        networks:
            - sail
        environment:
            - APP_NAME=Municipality
            - APP_ENV=local
            - APP_KEY=base64:mXouEHDVQd6YlJ8qrZlNWLF2mDV34+ivDdAn4Y57pac=
            - APP_DEBUG=false
            - APP_TIMEZONE=UTC
            - APP_URL=https://municipal-system.laraplay.fun
            - ASSET_URL=https://municipal-system.laraplay.fun
            - VITE_APP_URL=https://municipal-system.laraplay.fun
            - APP_LOCALE=ar
            - APP_FALLBACK_LOCALE=ar
            - APP_FAKER_LOCALE=en_US
            - DB_CONNECTION=sqlite
            - SESSION_DRIVER=cookie
            - SESSION_ENCRYPT=true
            - QUEUE_CONNECTION=database
            - FILESYSTEM_DISK=local

    # Uncomment if using Redis
    # redis:
    #     image: redis:alpine
    #     networks:
    #         - sail

    # Run the queue worker
    queue:
        image: laravel-app
        command: php artisan queue:work
        networks:
            - sail
        depends_on:
            - app

networks:
    sail:
        driver: bridge
